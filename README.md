# Marlin
MKS Gen 1.4 + BL-Touch customized version.

# Description：
*機型：
Prusa i3 DIY 鋁擠線軌版

*韌體：
Marlin 1.1.8

*電機：
MKS Gen v1.4 一體板 (Arduino Mega 2560 R3 + Ramps 1.4)
TMC2130 5顆 (XYZZE，備用A4988 8顆)
馬達整流濾波器 4個 (XYZZ)
步進馬達 1.3A 5顆
MK8擠出機 1組
TFT3.5吋觸碰螢幕 2個 (備用1個)
斷料偵測 1個
限位開關 3個
TL-Touch 1個
熱敏電阻溫度偵測 2個 (噴嘴、熱床)
300W電源供應器 1個

*機構：
歐規2020鋁材
三軸線軌 (XYYZZ共5條)
梅花聯軸器 2顆
T8螺桿8mm導程 兩根
T8螺桿消間隙 2顆
5125迷你鼓風機 1個 (TMC2130散熱)
4010靜音風扇 3個 (主板2個、擠出機1個)
3010靜音風扇 2個 (噴嘴1個、備用1個)

// X&Y軸:
// GT2皮帶 + 16齒同步輪
// GT2皮帶齒距2mm，一圈16齒表示轉一圈移動32mm
// 步進馬達步進角1.8度，晶片驅動16微步
// 表示轉一圈需要(360/1.8)*16=3200步
// 此軸移動1mm需要3200/32=100步

// Z軸:
// T8螺桿導程8mm，表示轉一圈會移動8mm
// 步進馬達步進角1.8度，晶片驅動16微步
// 表示轉一圈需要(360/1.8)*16=3200步
// 此軸移動1mm需要3200/8=400步

// E擠出機:
// MK8擠出齒輪，齒輪直徑11mm
// 圓周為11*PI=34.54mm
// 步進馬達步進角1.8度，晶片驅動16微步
// 表示轉一圈需要(360/1.8)*16=3200步
// 此軸移動1mm需要3200/34.54=92.646步
// 公式:(3200*擠出機齒輪比)/(pi*擠出齒輪直徑)

// 步進馬達1.3A，A4988 Rs=0.1Ω、電流上限2A，Vref應設定成1.6V
// (1.4/0.7)*8*0.1Ω = 1.6
// 目前實際設定值為0.65V/(8*0.1Ω) = 0.8125A 轉換RMS電流 => 0.815A/1.41 = 0.578A
// 步進馬達1.3A，TMC2130晶片
// 目前實際設定值為1.0V*1.77/2.5 = 0.71A，加速度設為1000

// BL-Touch自動調平相關指令：
// G28 (X、Y歸零，Z回中間歸零)
// G29 (產生3*3偵測矩陣)
// M851 Z-1.7 (調整Z軸高度)
// M420 V (檢視偵測矩陣)
// M420 S1 (啟用自動調平功能)
// M500 (儲存參數至EEPROM)
// M501 (載入EEPROM儲存參數)
// M502 (清除EEPROM參數)
// M503 (檢視EEPROM參數)

// 擠出頭、熱床溫度控制PID參數自動校正：
// M303 E0 C8 S200 (自動調整擠出頭PID參數，溫度震盪8次後停止，目標溫度200度)
// M303 E-1 C8 S70 (自動調整熱床PID參數，溫度震盪8次後停止，目標溫度70度)
// 若收到錯誤訊息"PID Autotune failed! Temperature too high"，代表初始測試條件會讓溫度超出目標溫度20度。
// 這時候需要修正韌體中的PID_MAX(加熱頭最高電流上限)。
// 若收到 "PID Autotune finished! Put the Kp, Ki and Kd constants into Configuration.h" 的訊息後，
// 用測試過程中最後一輪的 Kp, Ki, Kd 值替換掉Configuration.h中的DEFAULT_Kp, DEFAULT_Ki 和 DEFAULT_Kd。
